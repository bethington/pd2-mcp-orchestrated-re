# config/docker/supervisord.conf
[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[program:xvfb]
command=/usr/bin/Xvfb :1 -screen 0 1068x600x16 -shmem -nolisten tcp -auth /dev/null +extension GLX +extension RENDER +extension RANDR -dpi 96
autostart=true
autorestart=true
priority=100

[program:fluxbox]
command=/usr/bin/fluxbox -display :1 -verbose 0 -log /var/log/fluxbox.log
autostart=true
autorestart=true
priority=200
environment=DISPLAY=:1

[program:vnc]
command=/usr/bin/x11vnc -display :1 -nopw -listen 0.0.0.0 -xkb -forever -shared -threads -noxdamage -noxfixes -rfbport 5900 -desktop "Diablo2-Analysis" -o /var/log/x11vnc.log
autostart=true
autorestart=true
priority=300
redirect_stderr=true
stdout_logfile=/var/log/vnc.log
stdout_logfile_maxbytes=10MB

[program:setup-wine]
command=/usr/local/bin/setup_wine.sh
autostart=true
autorestart=false
priority=400
redirect_stderr=true
stdout_logfile=/var/log/setup-wine.log
stdout_logfile_maxbytes=10MB
startsecs=1
startretries=1

[program:diablo2]
command=/usr/local/bin/start_d2.sh
autostart=true
autorestart=true
priority=500
redirect_stderr=true
stdout_logfile=/var/log/diablo2.log
stdout_logfile_maxbytes=10MB

[program:game-state-api]
command=/usr/bin/python3 /app/game_state_api_fixed.py
directory=/app
autostart=true
autorestart=true
priority=600
redirect_stderr=true
stdout_logfile=/var/log/game-state-api.log
stdout_logfile_maxbytes=10MB
environment=PYTHONPATH=/app:/app/src

[program:mcp-server]
command=/usr/bin/python3 /app/diablo2_mcp_server.py
directory=/app
autostart=true
autorestart=true
priority=700
redirect_stderr=true
stdout_logfile=/var/log/mcp-server.log
stdout_logfile_maxbytes=10MB
stderr_logfile=/var/log/mcp-server-error.log
environment=PYTHONPATH=/app:/app/src

[program:d2-monitor]
command=/usr/bin/python3 /usr/local/bin/diablo2_monitor.py
autostart=true
autorestart=true
priority=800
environment=PYTHONPATH=/app:/app/src:/usr/local/bin
redirect_stderr=true
stdout_logfile=/var/log/d2-monitor.log
stdout_logfile_maxbytes=10MB
